!function(t){t.errorLog=function(o){console.error(o)},t.app=t.angular.module("p",["ngMessages"]).run(["$rootScope","$timeout",function(e,n){e.config=t.config,e.timeWarning=5<Math.abs(t.config.timeAccuracy),e.ClientJSInfo=function(){return{devicePixelRatio:t.devicePixelRatio,screenPixelDepth:t.screen.pixelDepth,screenColorDepth:t.screen.colorDepth,screenWidth:t.screen.width,screenHeight:t.screen.height,userAgent:navigator.userAgent}},e.getTimeAccuracy=function(){var o,e;return"Intl"in t&&"RelativeTimeFormat"in Intl?(o=new Intl.RelativeTimeFormat(t.config.lang,{style:"short"}),(e=t.config.timeAccuracy)<=120?o.format(e,"seconds"):e<=3600?o.format(e,"minute"):e<=86400?o.format(e,"hour"):o.format(e,"day")):t.config.timeAccuracy},e.getCountryName=function(o){if("Intl"in t&&"DisplayNames"in Intl)try{const e=new Intl.DisplayNames([t.config.lang],{type:"region"});return e.of(o)}catch(o){}return o},e.failed=!1,e.reload=function(o){e.failed=!0,n(function(){t.location=t.location},o)},e.justReload=function(){t.location=t.location},e.getCountryFlag=function(o){if(o)try{return o.toUpperCase().replace(/./g,function(o){return String.fromCodePoint(o.charCodeAt(0)+127397)})}catch(o){}return""},e.mailTo=function(){var o=t.location.hostname;return["mailto:",t.config.supportInfo.email,"?subject=",encodeURIComponent("report protection "+e.config.challengeType+" on "+o),"&body=",encodeURIComponent(["node: "+t.config.ipData.nodeID,"ip: "+t.config.ipData.ip,"host: "+o,"country: "+t.config.ipData.country,"asn: "+t.config.ipData.asn,"asn name: "+t.config.ipData.asn_org].join("\r\n"))].join("")},e.urlSupport=function(){var o=t.location.hostname;return t.config.supportInfo.url+"?"+["mode=protection","node="+encodeURIComponent(t.config.ipData.nodeID),"type="+encodeURIComponent(e.config.challengeType),"host="+encodeURIComponent(o),"ip="+encodeURIComponent(t.config.ipData.ip),"country="+encodeURIComponent(t.config.ipData.country),"asn="+encodeURIComponent(t.config.ipData.asn),"asn_org="+encodeURIComponent(t.config.ipData.asn_org)].join("&")},n(function(){document.querySelector("#app").style.display="block"},200)}])}(window),function application(window){window.app.controller("totp",["$scope","$rootScope","$timeout","$interval","$http",function TOTPChallenge($scope,$rootScope,$timeout,$interval,$http){var waitSeconds=parseInt($rootScope.config.waitSeconds,10),start=Math.round(Date.now()/1e3),end=start+waitSeconds+2,total=end-start;$scope.progress=0,$scope.jsValue="",$scope.formData={totpValue:""},$scope.jsValueSolve=function jsValueSolve(){$http({url:window.config.baseURL+"/challenge",method:"PATCH",data:{t:window.config.challengeToken}}).then(function onResponse(response){var data=response.data,value=(window.config.challengeToken=data.t,eval(window.atob(data.js)),window.jsv());delete window.jsv,window.jsv=void 0,$scope.jsValue=value,$scope.captcha=data.captcha,document.getElementById("inputTOTP").focus()}).catch(function(){$rootScope.reload(3e3)})},$scope.solve=function(o){return $http({url:window.config.baseURL+"/challenge",method:"POST",data:{t:window.config.challengeToken,j_v:$scope.jsValue,t_v:$scope.formData.totpValue.toString()}}).then(function(){window.location.href=$rootScope.config.protectedPath}).catch(function(){$rootScope.reload(3e3)}),o&&(o.stopPropagation(),o.preventDefault()),!1},$scope.progressUpdate=function(){$timeout(function(){var o=Math.round(Date.now()/1e3)-start,o=Math.round(o/total*100);o<100?($scope.progress=Math.floor(o),$scope.progressUpdate()):($scope.progress=100,$scope.jsValueSolve())},500)},$scope.progressUpdate(),$scope.totpProgress=0,$scope.totpProgressClass="",$interval(function(){var o=(new Date).getSeconds(),e=Math.round(o/30*100),o=(30<o&&(e=Math.round((o-30)/30*100)),Math.abs(50-e));$scope.totpProgress=e,$scope.totpProgressClass=40<o?"is-danger":30<o?"is-warning":"is-success"},500)}])}(window);